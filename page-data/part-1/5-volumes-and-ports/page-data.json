{"componentChunkName":"component---src-templates-course-content-template-js","path":"/part-1/5-volumes-and-ports","result":{"data":{"page":{"htmlAst":{"type":"element","tagName":"div","properties":{},"children":[{"type":"element","tagName":"exercise","properties":{"name":"docker -v (bind mount)"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We can use volumes to make it easier to store the downloads outside the containers ephemeral storage. With "},{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"bind mount"}]},{"type":"text","value":" we can mount a file or directory from our own machine into the container. Let's start another container with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-v"}]},{"type":"text","value":" option, that requires an absolute path. We mount our current folder as "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/app"}]},{"type":"text","value":" in our container, overwriting everything that we have put in that folder in our Dockerfile."}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"docker run -v \"$(pwd):/app\" youtube-dl https://imgur.com/JY5tHqr"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"So a volume is simply a folder (or a file) that is shared between the host machine and the container. If a file in volume is modified by a program that's running inside the container the changes are also saved from destruction when the container is shut down as the file exists on the host machine. This is the main use for volumes as otherwise all of the files wouldn't be accessible when restarting the container. Volumes also can be used to share files between containers and run programs that are able to load changed files."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In our youtube-dl we wanted to mount the whole directory since the files are fairly randomly named. If we wish to create a volume with only a single file we could also do that by pointing to it. For example "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-v $(pwd)/material.md:/app/material.md"}]},{"type":"text","value":" this way we could edit the material.md locally and have it change in the container (and vice versa). Note also that "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-v"}]},{"type":"text","value":" creates a directory if the file does not exist."}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.9: Volumes"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this exercise we won't create a new Dockerfile."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Image "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"devopsdockeruh/simple-web-service"}]},{"type":"text","value":" creates a timestamp every two seconds to "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/usr/src/app/text.log"}]},{"type":"text","value":" when it's not given a command. Start the\ncontainer with bind mount so that the logs are created into your filesystem."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit the command you used to complete the exercise."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Answer:"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"touch text.log\ndocker run -v \"$(pwd)/text.log:/usr/src/app/text.log\" -it devopsdockeruh/simple-web-service"}]}]}]}]},{"type":"element","tagName":"text-box","properties":{"variant":"learningObjectives","name":"Allowing external connections into containers"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The details on how programs communicate are not detailed in this course. Courses on Operating Systems and the Networking courses explain subjects in detail. In this course you only need to know the following simplified basics:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Sending messages: Programs can send messages to "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/URL","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"URL"}]},{"type":"text","value":" addresses such as this: "},{"type":"element","tagName":"a","properties":{"href":"http://127.0.0.1:3000","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://127.0.0.1:3000"}]},{"type":"text","value":" where http is the "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"protocol"}]}]},{"type":"text","value":", 127.0.0.1 is a ip address, and and 3000 is a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Port_(computer_networking)","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"port"}]}]},{"type":"text","value":". Note the ip part could also be a "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Hostname","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"hostname"}]}]},{"type":"text","value":": 127.0.0.1 is also called "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Localhost","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"localhost"}]}]},{"type":"text","value":" so instead you could use "},{"type":"element","tagName":"a","properties":{"href":"http://localhost:3000","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://localhost:3000"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Receiving messages: Programs can be assigned to listen to any available port. If a program is listening for traffic on port 3000, and a message is sent to that port, it will receive it (and possibly process it)."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The address "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"127.0.0.1"}]},{"type":"text","value":" and hostname "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"localhost"}]},{"type":"text","value":" are special ones, they refer to the machine or container itself, so if you are on a container and send message to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"localhost"}]},{"type":"text","value":", the target is the same container. Similarly, if you are sending the request from outside of a container to "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"localhost"}]},{"type":"text","value":", the target is your machine."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You can map your host machine port to a container port."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Opening a connection from outside world to a docker container happens in two steps:"}]},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Exposing port"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Publishing port"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Exposing a container port means telling Docker that the container listens to a certain port. This doesn't do much, except it helps humans with the configuration."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Publishing a port means that Docker will map host ports to the container ports."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To expose a port, add the line "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"EXPOSE <port>"}]},{"type":"text","value":" in your Dockerfile"}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"To publish a port, run the container with "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p <host-port>:<container-port>"}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If you leave out the host port and only specify the container port, docker will automatically choose a free port as the host port:"}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"docker run -p 4567 app-in-port"}]}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"We could also limit connections to certain protocol only, e.g. udp by adding the protocol at the end: "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"EXPOSE <port>/udp"}]},{"type":"text","value":" and "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p <host-port>:<container-port>/udp"}]},{"type":"text","value":"."}]}]},{"type":"element","tagName":"text-box","properties":{"name":"Security reminder: Opening a door to the internet","variant":"hint"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Since we are opening a port to the application, anyone from the internet could come in and access what you're running."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don't haphazardly open just any ports - a way for an attacker to get in is by exploiting a port you opened to an insecure server. An easy way to avoid this is by defining the host-side port like this "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p 127.0.0.1:3456:3000"}]},{"type":"text","value":". This will only allow requests from your computer through port 3456 to the application port 3000, with no outside access allowed."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The short syntax, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p 3456:3000"}]},{"type":"text","value":", will result in the same as "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-p 0.0.0.0:3456:3000"}]},{"type":"text","value":", which truly is opening the port to everyone."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Usually, this isn't risky. But depending on the application, it is something you should consider!"}]}]},{"type":"element","tagName":"exercise","properties":{"name":"Exercise 1.10: Ports open"},"children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In this exercise, we won't create a new Dockerfile."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The image "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"devopsdockeruh/simple-web-service"}]},{"type":"text","value":" will start a web service in port "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"8080"}]},{"type":"text","value":" when given the command \"server\". From 1.7 you should have an image ready for this. Use -p flag to access the contents with\nyour browser. The output to your browser should be something like:\n"},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"{ message: \"You connected to the following path: ..."}]}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Submit your used commands for this exercise."}]},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Answer"}]}]},{"type":"element","tagName":"div","properties":{"className":["gatsby-highlight"],"dataLanguage":"console"},"children":[{"type":"element","tagName":"pre","properties":{"className":["language-console"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-console"]},"children":[{"type":"text","value":"docker run -p 8080:8080 -it devopsdockeruh/simple-web-service server"}]}]}]}]}]},"html":"<div><exercise name='docker -v (bind mount)'><p>We can use volumes to make it easier to store the downloads outside the containers ephemeral storage. With <strong>bind mount</strong> we can mount a file or directory from our own machine into the container. Let's start another container with <code class=\"language-text\">-v</code> option, that requires an absolute path. We mount our current folder as <code class=\"language-text\">/app</code> in our container, overwriting everything that we have put in that folder in our Dockerfile.</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">docker run -v &quot;$(pwd):/app&quot; youtube-dl https://imgur.com/JY5tHqr</code></pre></div><p>So a volume is simply a folder (or a file) that is shared between the host machine and the container. If a file in volume is modified by a program that's running inside the container the changes are also saved from destruction when the container is shut down as the file exists on the host machine. This is the main use for volumes as otherwise all of the files wouldn't be accessible when restarting the container. Volumes also can be used to share files between containers and run programs that are able to load changed files.</p><p>In our youtube-dl we wanted to mount the whole directory since the files are fairly randomly named. If we wish to create a volume with only a single file we could also do that by pointing to it. For example <code class=\"language-text\">-v $(pwd)/material.md:/app/material.md</code> this way we could edit the material.md locally and have it change in the container (and vice versa). Note also that <code class=\"language-text\">-v</code> creates a directory if the file does not exist.</p></exercise><exercise name=\"Exercise 1.9: Volumes\"><p>In this exercise we won't create a new Dockerfile.</p><p>Image <code class=\"language-text\">devopsdockeruh/simple-web-service</code> creates a timestamp every two seconds to <code class=\"language-text\">/usr/src/app/text.log</code> when it's not given a command. Start the\ncontainer with bind mount so that the logs are created into your filesystem.</p><p>Submit the command you used to complete the exercise.</p><p><strong>Answer:</strong></p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">touch text.log\ndocker run -v &quot;$(pwd)/text.log:/usr/src/app/text.log&quot; -it devopsdockeruh/simple-web-service</code></pre></div></exercise><text-box variant='learningObjectives' name='Allowing external connections into containers'><p>The details on how programs communicate are not detailed in this course. Courses on Operating Systems and the Networking courses explain subjects in detail. In this course you only need to know the following simplified basics:</p><ul>\n<li>\n<p>Sending messages: Programs can send messages to <a href=\"https://en.wikipedia.org/wiki/URL\" target=\"_blank\" rel=\"noopener noreferrer\">URL</a> addresses such as this: <a href=\"http://127.0.0.1:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://127.0.0.1:3000</a> where http is the <a href=\"https://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol\" target=\"_blank\" rel=\"noopener noreferrer\"><em>protocol</em></a>, 127.0.0.1 is a ip address, and and 3000 is a <a href=\"https://en.wikipedia.org/wiki/Port_(computer_networking)\" target=\"_blank\" rel=\"noopener noreferrer\"><em>port</em></a>. Note the ip part could also be a <a href=\"https://en.wikipedia.org/wiki/Hostname\" target=\"_blank\" rel=\"noopener noreferrer\"><em>hostname</em></a>: 127.0.0.1 is also called <a href=\"https://en.wikipedia.org/wiki/Localhost\" target=\"_blank\" rel=\"noopener noreferrer\"><em>localhost</em></a> so instead you could use <a href=\"http://localhost:3000\" target=\"_blank\" rel=\"noopener noreferrer\">http://localhost:3000</a>.</p>\n</li>\n<li>\n<p>Receiving messages: Programs can be assigned to listen to any available port. If a program is listening for traffic on port 3000, and a message is sent to that port, it will receive it (and possibly process it).</p>\n</li>\n</ul><p>The address <em>127.0.0.1</em> and hostname <em>localhost</em> are special ones, they refer to the machine or container itself, so if you are on a container and send message to <em>localhost</em>, the target is the same container. Similarly, if you are sending the request from outside of a container to <em>localhost</em>, the target is your machine.</p><p>You can map your host machine port to a container port.</p><p>Opening a connection from outside world to a docker container happens in two steps:</p><ul>\n<li>\n<p>Exposing port</p>\n</li>\n<li>\n<p>Publishing port</p>\n</li>\n</ul><p>Exposing a container port means telling Docker that the container listens to a certain port. This doesn't do much, except it helps humans with the configuration.</p><p>Publishing a port means that Docker will map host ports to the container ports.</p><p>To expose a port, add the line <code class=\"language-text\">EXPOSE &lt;port&gt;</code> in your Dockerfile</p><p>To publish a port, run the container with <code class=\"language-text\">-p &lt;host-port&gt;:&lt;container-port&gt;</code></p><p>If you leave out the host port and only specify the container port, docker will automatically choose a free port as the host port:</p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">docker run -p 4567 app-in-port</code></pre></div><p>We could also limit connections to certain protocol only, e.g. udp by adding the protocol at the end: <code class=\"language-text\">EXPOSE &lt;port&gt;/udp</code> and <code class=\"language-text\">-p &lt;host-port&gt;:&lt;container-port&gt;/udp</code>.</p></text-box><text-box name=\"Security reminder: Opening a door to the internet\" variant=\"hint\"><p>Since we are opening a port to the application, anyone from the internet could come in and access what you're running.</p><p>Don't haphazardly open just any ports - a way for an attacker to get in is by exploiting a port you opened to an insecure server. An easy way to avoid this is by defining the host-side port like this <code class=\"language-text\">-p 127.0.0.1:3456:3000</code>. This will only allow requests from your computer through port 3456 to the application port 3000, with no outside access allowed.</p><p>The short syntax, <code class=\"language-text\">-p 3456:3000</code>, will result in the same as <code class=\"language-text\">-p 0.0.0.0:3456:3000</code>, which truly is opening the port to everyone.</p><p>Usually, this isn't risky. But depending on the application, it is something you should consider!</p></text-box><exercise name=\"Exercise 1.10: Ports open\"><p>In this exercise, we won't create a new Dockerfile.</p><p>The image <code class=\"language-text\">devopsdockeruh/simple-web-service</code> will start a web service in port <code class=\"language-text\">8080</code> when given the command \"server\". From 1.7 you should have an image ready for this. Use -p flag to access the contents with\nyour browser. The output to your browser should be something like:\n<code class=\"language-text\">{ message: &quot;You connected to the following path: ...</code></p><p>Submit your used commands for this exercise.</p><p><strong>Answer</strong></p><div class=\"gatsby-highlight\" data-language=\"console\"><pre class=\"language-console\"><code class=\"language-console\">docker run -p 8080:8080 -it devopsdockeruh/simple-web-service server</code></pre></div></exercise></div>","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"},"fileAbsolutePath":"/Users/mpa/dev/docker-hy/data/part-1/section-5.md"},"allPages":{"edges":[{"node":{"id":"948f83e9-b338-5b95-ae2d-a7c680eadb0c","frontmatter":{"path":"/frontmatter-guide","title":"Frontmatter-guide"}}},{"node":{"id":"fe138126-ea55-51b2-a071-8a7532aa51af","frontmatter":{"path":"/part-2","title":"Part 2"}}},{"node":{"id":"8147ba2c-1cbf-5878-b301-ef847e624e70","frontmatter":{"path":"/part-3/2-development","title":"Development with Docker"}}},{"node":{"id":"ed0e0aae-16de-5de9-8877-77337c24124f","frontmatter":{"path":"/part-3","title":"Part 3"}}},{"node":{"id":"1b7ed2f7-c954-577b-ac8d-cae5f2dfc838","frontmatter":{"path":"/part-2/2-docker-networking","title":"More Docker networking"}}},{"node":{"id":"3a0a776d-ec13-50e5-ade2-6c0d549f58ba","frontmatter":{"path":"/part-1","title":"Part 1"}}},{"node":{"id":"ad6b1fb2-b897-54c5-8ce5-00acf0c99caf","frontmatter":{"path":"/part-2/3-wordpress","title":"Wordpress"}}},{"node":{"id":"cea7278b-6d74-539e-b105-29dc780024b6","frontmatter":{"path":"/part-1/2-running-and-stopping","title":"Running and stopping containers"}}},{"node":{"id":"83f82958-678d-500e-8ce0-a2d587fed9c1","frontmatter":{"path":"/part-1/3-in-depth-dive-to-images","title":"In-depth dive to images"}}},{"node":{"id":"087c95a9-00b7-523d-bc13-85d227b71193","frontmatter":{"path":"/part-1/7-summary","title":"Summary"}}},{"node":{"id":"d3b909df-cb77-59a6-8402-f961bd2a7aff","frontmatter":{"path":"/part-1/5-volumes-and-ports","title":"Interacting with the container via volumes and ports"}}},{"node":{"id":"e8a51e48-cc89-5f08-8c00-2c3abe47d5a9","frontmatter":{"path":"/","title":"About this course"}}},{"node":{"id":"455aef79-d091-56bd-bace-e566c89238bb","frontmatter":{"path":"/part-1/1-getting-started","title":"Definitions and basic concepts"}}},{"node":{"id":"2b806816-8c59-5a3a-9b89-da8548d44e0a","frontmatter":{"path":"/part-1/4-defining-start-conditions","title":"Defining start conditions for the container"}}},{"node":{"id":"a3fe4972-edce-5bc7-9eb5-b355fac1ebf8","frontmatter":{"path":"/part-2/1-migrating-to-docker-compose","title":"Migrating to docker compose"}}},{"node":{"id":"3447594d-f3e4-56a2-8d83-12bf7ff5f3a4","frontmatter":{"path":"/part-3/1-using-non-root-user","title":"Using a non-root user"}}},{"node":{"id":"bc9490fd-c9f8-5a6a-8370-2ef946d4e3fa","frontmatter":{"path":"/part-3/4-extras","title":"Extras"}}},{"node":{"id":"67016067-426f-51cc-8ea0-3e16da657b13","frontmatter":{"path":"/part-3/3-multi-host-environments","title":"Multi-host environments"}}}]}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}